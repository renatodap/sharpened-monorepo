#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Block any changes to apps/feelsharper or packages used exclusively by it
PROTECTED_PATHS="^apps/feelsharper/"

# Check if any staged files match protected paths
STAGED_FILES=$(git diff --cached --name-only)

for file in $STAGED_FILES; do
  if echo "$file" | grep -E "$PROTECTED_PATHS" > /dev/null; then
    echo "❌ ERROR: Attempting to modify protected path: $file"
    echo "🚫 apps/feelsharper and its exclusive packages are off-limits!"
    echo "📝 Incident logged to docs/DECISION_LOG.md"
    
    # Log the incident
    echo "\n## $(date '+%Y-%m-%d %H:%M:%S') - BLOCKED: Attempted modification to protected path" >> docs/DECISION_LOG.md
    echo "- File: $file" >> docs/DECISION_LOG.md
    echo "- Action: Blocked by pre-commit hook" >> docs/DECISION_LOG.md
    
    exit 1
  fi
done

# Run typecheck and lint if we have changes
if [ -n "$STAGED_FILES" ]; then
  echo "✅ No protected paths modified. Proceeding with checks..."
fi

exit 0
